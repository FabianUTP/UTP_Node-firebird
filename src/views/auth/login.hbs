<link rel="stylesheet" href="/css/login.css">


<div class="w-100 d-flex justify-content-center align-items-center"
  style="padding-top: 0%; left: 0%; position: absolute;">
  <div class="card w-100" style="max-width: 850px;">

    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
          role="tab" aria-controls="nav-home" aria-selected="true">Alumno</button>
        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button"
          role="tab" aria-controls="nav-profile" aria-selected="false">Aspirante</button>
        <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button"
          role="tab" aria-controls="nav-contact" aria-selected="false">Profesor</button>
        <button class="nav-link" id="nav-disabled-tab" data-bs-toggle="tab" data-bs-target="#nav-disabled" type="button"
          role="tab" aria-controls="nav-disabled" aria-selected="false">Admin</button>
      </div>
    </nav>


    <div class="tab-content" id="nav-tabContent">

      <div class="card-title text-center">
        <img src="./imgs/logoRojo.jpg" width="250" alt="">
        <h1>SII-UTPONIENTE</h1>
      </div>

      <div class="px-5">
        {{>msj_error}}
      </div>

      {{!-- Section Alumno --}}
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
        <div class="card-body px-5">
          <form id="form" action="/login/alumno" method="post" class="d-flex flex-column justify-content-center"
            onsubmit="return validateForm()">
            <div>
              <label for="User" class="form-label">MATRICULA</label>
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-person"></i>
                    </div>
                  </div>
                </div>
                <input type="text" class="form-control" name="user" id="user" required maxlength="8" pattern="\d{1,8}"  placeholder="Ingresar tu Matricula">
              </div>
            </div>

            <div class="mb-4">
              <label for="pass" class="form-label fs-5">CONTRASEÑA</label>
              <div class="input-group">
                <!-- Icono de la contraseña -->
                <div class="input-group-text">
                  <i class="bi bi-lock"></i>
                </div>
                <!-- Campo de contraseña -->
                <input type="password" class="form-control" name="password" id="pass" required
                  placeholder="Ingresa tu contraseña">
                <!-- Botón para mostrar/ocultar la contraseña -->
                <button type="button" class="btn btn-outline-secondary btn-sm p-0" id="toggle-password"
                  style="width: 35px; height: 35px;">
                  <i class="bi bi-eye-slash" id="password-icon" style="font-size: 18px;"></i>
                </button>
              </div>
            </div>

            <!-- Enlace para "Olvidaste tu contraseña" -->
            <div class="text-end">
              <a href="#" class="text-decoration-none fs-6 text-primary">¿Olvidaste tu contraseña?</a>
            </div>

            <script>
              // Script para cambiar entre mostrar y ocultar la contraseña sin animación
              const togglePasswordButton = document.getElementById('toggle-password');
              const passwordInput = document.getElementById('pass');
              const passwordIcon = document.getElementById('password-icon');

              togglePasswordButton.addEventListener('click', () => {
                // Cambiar el tipo de input de contraseña
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;

                // Cambiar el ícono sin animación
                if (passwordInput.type === 'password') {
                  passwordIcon.classList.remove('bi-eye');
                  passwordIcon.classList.add('bi-eye-slash');
                } else {
                  passwordIcon.classList.remove('bi-eye-slash');
                  passwordIcon.classList.add('bi-eye');
                }
              });
            </script>




            <div class="pt-3 text-center">
              <button type="submit" class="btn btn-outline-primary" id="btn">Iniciar sesión</button>
            </div>

          </form>
        </div>
      </div>



      {{!-- Section Aspirante Login --}}
      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
        <div class="card-body px-5">

          <form id="form" action="/login/aspirante" method="post" class="d-flex flex-column justify-content-center">
            <div>

              <label for="matricula" class="form-label">FOLIO DE REGISTRO</label>

              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-person"></i>
                    </div>
                  </div>
                </div>
                <input type="text" class="form-control" name="user" id="user" required>
              </div>
            </div>

            <div>
              <label for="pass" class="form-label">CONTRASEÑA</label>
              <div class="input-group mb-2 ">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-key"></i>
                    </div>
                  </div>
                </div>
                <input type="password" class="form-control" name="password" id="pass">


              </div>
            </div>

            {{!-- <div class="pt-1">
              <a href="#" Olvidaste tu contraseña?</a>
            </div> --}}

            <div class="pt-1">
              <a href="/verificacionCURP">Nuevo aspirante</a>
            </div>


            <div class="pt-3 text-center">
              <button type="submit" class="btn btn-outline-primary" id="btn">Iniciar sesión</button>
            </div>

          </form>
        </div>
      </div>

      {{!-- Section Profesor Login --}}
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab" tabindex="0">
        <div class="card-body px-5">

          <form id="form" action="/login/profe" method="post" class="d-flex flex-column justify-content-center">
            <div>

              <label for="CLAVEPROFESOR" class="form-label">FOLIO DE PROFESORES</label>

              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-person"></i>
                    </div>
                  </div>
                </div>
                <input type="text" class="form-control" name="user" id="user" required maxlength="6"
                  pattern="[A-Za-z0-9]{1,6}" title="La clabe del profesor debe ser de hasta 6 caracters.">
              </div>
            </div>

            <div>
              <label for="pass" class="form-label">CONTRASEÑA</label>
              <div class="input-group mb-2 ">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-key"></i>
                    </div>
                  </div>
                </div>
                <input type="password" class="form-control" name="password" id="pass">


              </div>
            </div>

            <div class="pt-1">
              <a href="#">Olvidaste tu contraseña?</a>
            </div>

            <div class="pt-3 text-center">
              <button type="submit" class="btn btn-outline-primary" id="btn">Iniciar sesión</button>
            </div>

          </form>
        </div>
      </div>

      {{!-- Section Admin Login --}}
      <div class="tab-pane fade" id="nav-disabled" role="tabpanel" aria-labelledby="nav-disabled-tab" tabindex="0">
        <div class="card-body px-5">

          <form id="form" action="/login/admin" method="post" class="d-flex flex-column justify-content-center">
            <div>

              <label for="matricula" class="form-label">USUARIOS</label>

              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-person"></i>
                    </div>
                  </div>
                </div>
                <input type="text" class="form-control" name="user" id="user" required>
              </div>
            </div>

            <div>
              <label for="pass" class="form-label">CONTRASEÑA</label>
              <div class="input-group mb-2 ">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <div class="icon">
                      <i class="bi bi-key"></i>
                    </div>
                  </div>
                </div>
                <input type="password" class="form-control" name="password" id="pass">


              </div>
            </div>

            <div class="pt-1">
              <a href="#">Olvidaste tu contraseña?</a>
            </div>

            <div class="pt-3 text-center">
              <button type="submit" class="btn btn-outline-primary" id="btn">Iniciar sesión</button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
  // Mostrar y ocultar contraseña
  document.querySelectorAll('.btn-show').forEach(button => {
    button.addEventListener('click', () => {
      const input = button.previousElementSibling;
      input.type === 'password' ? input.type = 'text' : input.type = 'password';
    });
  });

  // Añadir validación del formulario
  const forms = document.querySelectorAll('.needs-validation');
  forms.forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });
  });


  function validateForm() {
    const password = document.getElementById('pass').value;
    const errorMessage = document.getElementById('error-message');

    if (!password) {
      errorMessage.style.display = 'block';
      return false; // Evita que el formulario se envíe
    }

    errorMessage.style.display = 'none';
    return true; // Permite el envío del formulario
  }


  document.getElementById("btn").addEventListener("click", async () => {
    const user = document.getElementById("user").value;
    const password = document.getElementById("pass").value;

    const response = await fetch("/login/alumno", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user, password })
    });

    const data = await response.json();

    if (data.success) {
      sessionStorage.setItem("matriculaAuth", data.matricula); // Guardar la matrícula
      window.location.href = "/"; // Redirigir al inicio
    } else {
      alert(data.error); // Mostrar error si la autenticación falla
    }
  });
  // Obtener el botón y el campo de contraseña
  const togglePasswordButton = document.getElementById('toggle-password');
  const passwordInput = document.getElementById('pass');
  const passwordIcon = document.getElementById('password-icon');

  // Añadir el evento para cambiar el tipo de contraseña y el ícono
  togglePasswordButton.addEventListener('click', () => {
    // Alternar el tipo de input entre "password" y "text"
    const type = passwordInput.type === 'password' ? 'text' : 'password';
    passwordInput.type = type;

    // Alternar el ícono entre "bi-eye-slash" (ocultar) y "bi-eye" (mostrar)
    passwordIcon.classList.toggle('bi-eye');
    passwordIcon.classList.toggle('bi-eye-slash');
  });

</script>